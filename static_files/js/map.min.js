function trackClick(e){var t=$(e.target).closest(".ga-tracking"),n=t.attr("data-category")?t.attr("data-category"):"",o=t.attr("data-action")?t.attr("data-action"):"",a=t.attr("data-label")?t.attr("data-label"):"";_gaq.push(["_trackEvent",n,o,a])}function gaTracking(){$(".ga-tracking").live("mousedown",trackClick)}var isDesktopWidth=!0;$(window).width()<768&&(isDesktopWidth=!1);var CampusMap=function(e){function t(e){var t=[];$.ajax({url:"/shuttles/"+e.shuttleRouteId+"/gps/.json",dataType:"json",async:!0,success:function(n){"undefined"!=typeof n.locations&&(null!=e.gpsMarkers&&$.each(e.gpsMarkers,function(e,t){t.setMap(null)}),$.each(n.locations,function(n,o){var a={url:k+"/images/markers/shuttle.png",size:new google.maps.Size(25,25)},i=new google.maps.Marker({position:new google.maps.LatLng(o.lat,o.lon),map:A,title:o.name,visible:e.active,icon:a}),l=new google.maps.InfoWindow({content:"<div>Shuttle "+o.id+"</div>"});google.maps.event.addListener(i,"click",function(){l.open(A,i)}),t.push(i)})),e.gpsMarkers=t}})}function n(){var e=this;this.infos=[],this.register=function(t){e.infos.push(t)},this.clear=function(){$.each(e.infos,function(e,t){t.close()}),e.infos=[]}}function o(e,t,n){var o=this,a=new google.maps.LatLng(e[0],e[1]),i=null,l=null,s={link:null,pan:!1};this.box=null,n=$.extend({},s,n),null!=n.link&&(t='<a href="'+n.link+'">'+t+"</a>"),i=$('<div class="iBox"><a class="iclose"></a>'+t+"</div>"),l=$('<div id="testBox" class="iBox">'+i+"</div>")[0],$("body").append(l),i.find(".iclose").click(function(e){e.preventDefault(),o.box.close()}),i=i[0],this.box=new InfoBox({content:i,alignBottom:!0,pixelOffset:new google.maps.Size(-18,-3),maxWidth:0,closeBoxURL:"",pane:"floatPane",infoBoxClearance:new google.maps.Size(1,1),enableEventPropagation:!1}),this.box.setPosition(a),this.box.open(A),n.pan&&A.panTo(a),this.close=function(){o.box.close()}}function a(){var e=this;this.layers=[],this.get_layer=function(t){var n=null;return $.each(e.layers,function(e,o){return o.name==t?(n=o,!1):void 0}),n},this.load_all_layers=function(){$.each(e.layers,function(e,t){t.toggle()})},this.register_layer=function(t){e.layers.push(t)}}function i(e){var n=this;this.active=!1,this.name=e,this.layer=null,this.markers=null,this.shuttleRouteId=null,this.gpsMarkers=null,this.toggle=function(){n.active?n.deactivate():n.activate()},this.activate=function(){1!=n.active&&(n.active=!0,null!=n.layer&&n.layer.setMap(A),null!=n.markers&&$.each(n.markers,function(e,t){t.setVisible(!0)}),null!=n.shuttleRouteId&&t(n))},this.deactivate=function(){0!=n.active&&(n.active=!1,null!=n.layer&&n.layer.setMap(null),null!=n.markers&&$.each(n.markers,function(e,t){t.setVisible(!1)}),null!=n.gpsMarkers&&$.each(n.gpsMarkers,function(e,t){t.setVisible(!1)}))}}function s(){function e(){f.addClass("slide-out"),f.height($(document).height())}function t(){f.removeClass("slide-out")}function n(){$("#mobile-menu-trigger").click(e)}function o(){f.find(".close-icon").click(t)}function a(){$(document).click(function(e){var n=$(e.target);n.closest("#mobile-menu").length||n.closest("#mobile-menu-trigger").length||f.width()>200&&t()})}function i(e){clearTimeout(T);var n=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),o={url:k+"/images/markers/location.png",size:new google.maps.Size(25,25)};_?(_.setPosition(n),A.panTo(n),b.open(A,_)):(_=new google.maps.Marker({position:n,map:A,icon:o,title:"You are here!"}),A.panTo(n),b.open(A,_),google.maps.event.addListener(_,"click",function(e){b.open(A,_)})),w.closest(".menu-highlight").removeClass("menu-highlight"),w.toggleClass("fa-spinner fa-pulse fa-compass"),t()}function s(e){switch(clearTimeout(T),w.closest(".menu-highlight").removeClass("menu-highlight"),w.toggleClass("fa-spinner fa-pulse fa-compass"),e.code){case e.PERMISSION_DENIED:g("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:alert("Location information is unavailable. Verify that GPS is enabled.");break;case e.TIMEOUT:alert("The request to get location timed out.");break;case e.UNKNOWN_ERROR:alert("Unable to get location.")}}function r(){w.closest(".menu-highlight").removeClass("menu-highlight"),w.toggleClass("fa-spinner fa-pulse fa-compass"),alert("Location information is unavailable. Verify that GPS is enabled.")}function c(){navigator.geolocation?(T=setTimeout(r,5e3),navigator.geolocation.getCurrentPosition(i,s)):(alert("Geolocation is not supported by this browser."),t())}function u(e){var t=e.closest("li"),n=t.find("ul").eq(0);e.is("label")&&t.toggleClass("menu-highlight"),(!t.attr("data-menu-highlight")||t.attr("data-menu-highlight")&&t.attr("data-menu-highlight")===!0)&&t.toggleClass("menu-highlight"),n.length&&n.slideToggle(function(){t.find(".toggle-icon").eq(0).toggleClass("fa-chevron-down fa-chevron-up")})}function h(e){var n=$(e.target),o=n.closest("h4").attr("data-menu");switch(u(n),o){case"location":w.toggleClass("fa-spinner fa-pulse fa-compass"),c();break;case"parking":U.get_layer("parking").toggle();break;case"emergency":var a=!0;for(l in d)1!=U.get_layer(d[l]).active&&(a=!1);for(l in d)1==a?U.get_layer(d[l]).deactivate():U.get_layer(d[l]).activate();break;case"food":U.get_layer("food").toggle(),t()}}function p(){y.click(h)}function m(){n(),a(),o(),p()}var f=$("#mobile-menu"),v=$("#shuttle-menu"),y=$(".menu-item"),_,b=new google.maps.InfoWindow({content:"<div>You are here!</div>"}),w=$(".loading-target"),T;m()}function r(){function e(){var e=l-a.width();i.is(":visible")&&(e-=i.width()),$("#menu .gap").width(e)}var t=this,n=$("#menu-wrap"),o=$("#menu-window"),a=$("#tab-one"),i=$("#tab-two"),l=$("#menu-header").width()-10,s=$("menu_stage");o.equalHeights(),e(),$(".nav").click(function(){var e=$(this).attr("data-nav");$.cookie("menu_page",e),e-=1,o.animate({"margin-left":"-"+230*Number(e)},300)}),$("#menu-hide,#menu-screen").click(function(e){e.preventDefault();var t=$("#menu-screen");t.is(":visible")?(o.slideDown(),t.hide(),n.removeClass("closed").animate({opacity:1},300)):(o.slideUp(),n.animate({opacity:.5},300,function(){n.addClass("closed")}),t.show())}),a.click(function(){t.change_tabs()}),i.click(function(){t.change_tabs({label:$(this).text(),html:s.html()})}),this.change_buttons=function(e){var t={loc_id:!1,title:!1,subject:"UCF Campus Map",body:escape("UCF Campus Map\nhttp://map.ucf.edu/"),print:R+"/print/?",toggle_illustrated:!1},n=$.extend({},t,e),o="illustrated"===A.mapTypeId;if(n.toggle_illustrated){var a=$("#print").attr("href");return a=a.replace("&illustrated",""),o&&(a+="&illustrated"),void $("#print").attr("href",a)}if(n.loc_id){var i=escape(n.title),l=R+"/?show="+n.loc_id;l=escape(l),n.subject=escape("UCF Campus Map - ")+i,n.body=i+escape("\n")+l,n.print=n.print+"&show="+n.loc_id}var s="mailto:?subject="+n.subject+"&body="+n.body;$("#email").attr("href",s),o&&(n.print=n.print+"&illustrated"),$("#print").attr("href",n.print)},this.change_buttons(),this.change_tabs=function(t,n){var l={label:!1,html:!1},s=$.extend({},l,t);s.label||s.html?(i.removeClass("off"),a.addClass("off"),s.label&&$("#menu-title").html(s.label),i.show(),s.html&&($("#menu-stage").empty(),s.html instanceof jQuery?s.html.appendTo("#menu-stage"):$("#menu-stage").html(s.html)),o.animate({"margin-left":-690},300),e(),o.equalHeights()):(o.animate({"margin-left":0},300),a.removeClass("off"),i.addClass("off")),"undefined"!=typeof n&&"function"==typeof n&&n()},A.controls[google.maps.ControlPosition.RIGHT_TOP].push(n[0])}function c(){function e(){$("#search-form").submit()}function t(){null!=r&&r.abort()}var n=this,o=null,a=null,i=null,l=null,s=400,r=null,c={ENTER:13,LEFT_ARROW:37,RIGHT_ARROW:39,SHIFT:16,CONTROL:17,OPTION:18,COMMAND:224,DOWN:40,UP:38,ESCAPE:27},u=function(e){i.empty().show(),i.height(q),clearTimeout(l),l=setTimeout(function(){i.append('<li><a data-pk="searching">Searching&hellip;</a></li>'),r=$.getJSON([_,"json"].join("."),{q:e},function(t,n,o){if(i.empty(),t&&t.results&&"undefined"!=typeof t.results){var a=t.results.locations,l=t.results.organizations;if(a.length){var s=[],r=[],c=[];$.each(a,function(t,n){var o="",a=H.highlight_term(n.link,e,!0);n.orgs=[],$.each(l,function(t,o){n.id==o.bldg_id&&(o.name=H.highlight_term(o.name,e),n.orgs.push(o))}),n.orgs.length&&n.link!=a?(n.link=a,s.push(n)):n.orgs.length?r.push(n):n.link!=a&&(n.link=a,c.push(n))});var u=0;$.each(s.concat(r,c),function(e,n){var o="";return u+=n.orgs.length,$.each(n.orgs,function(e,t){o+="<li>"+t.name+"</li>"}),""!=o&&(o="<ul>"+o+"</ul>"),i.append("<li>"+n.link+o+"</ul>"),u>11?(i.append('<li class="more"><a href="'+t.results_page_url+'">More Results &hellip;</a></li>'),!1):void u++})}else i.append('<li><a data-pk="null">No results</a></li>')}})},s)};o=function(){var t=null,n=null,o=null,a=null,i=null;return t=document.createElement("div"),n=document.createElement("form"),o=document.createElement("input"),a=document.createElement("a"),icon=document.createElement("i"),i=document.createElement("ul"),t.id="search",t.style.zIndex=9999,n.method="get",n.action=_,n.id="search-form",o.type="text",o.name="q",o.autocomplete="off",o.placeholder="Search Map",icon.className="fa fa-search fa-2x",a.id="search-submit",a.title="search icon",a.onclick=e,a.appendChild(icon),i.id="search-results",i.style.display="none",n.appendChild(o),n.appendChild(a),t.appendChild(n),t.appendChild(i),t}(),A.controls[google.maps.ControlPosition.TOP_LEFT].push(o),o=$(o),a=o.find("input"),i=o.find(" > ul"),""!==S&&(a.val(S),u()),$(document).click(function(e){var t=$(e.target);0===t.closest("#search").length&&i.hide()}),a.focus(function(e){""!=$(this).val()&&$(this).trigger("keyup")}).keydown(function(e){var t=H.parse_keycode(e);t==c.ENTER}).keyup(function(e){var o=H.parse_keycode(e),a=$(this).val();if(t(),-1===$.inArray(o,[c.LEFT_ARROW,c.RIGHT_ARROW,c.SHIFT,c.CONTROL,c.OPTION,c.COMMAND]))if(o===c.DOWN){var l=i.find(".hover"),s=null;l.length?(l.removeClass("hover"),s=l.next()):s=i.find("li:first"),s.addClass("hover"),$("body").trigger("search-result-highlighted",[s])}else if(o===c.UP){var l=i.find(".hover"),s=null;l.length?(l.removeClass("hover"),s=l.prev()):s=i.find("li:last"),s.addClass("hover"),$("body").trigger("search-result-highlighted",[s])}else o===c.ESCAPE?(t(),n.hide_results()):""===a?i.hide():u(a)}),this.hide_results=function(){i.empty().hide()}}function u(){var e=this;this.get_illustrated_tile=function(e,t){var n=null,o="white.png",a={x:2.5,y:3.5},i=Math.pow(2,t-13);return n=12>t||e.y<0||e.x<0||12===t&&(e.y>1||e.x>2)||e.x>=a.x*i||e.y>=a.y*i?o:"zoom-"+t+"/"+t+"-"+e.x+"-"+e.y+".jpg",'url("http://cdn.ucf.edu/map/tiles/'+n+"?_="+(new Date).getTime()+'")'},this.highlight_term=function(e,t,n){if("undefined"!=typeof n&&n){var o=e.match(/<a([^>]+)>([^<]*)<\/a>/);return null!=o?"<a"+o[1]+">"+H.highlight_term(o[2],t)+"</a>":e}var a=e.toLowerCase(),i=a.indexOf(t.toLowerCase());return i>-1?e.substr(0,i)+'<span class="highlight">'+e.substr(i,t.length)+"</span>"+e.substr(i+t.length):e},this.parse_keycode=function(e){return document.layers?e.which:document.all?e.keyCode:document.getElementById?e.keyCode:0},this.get_google_image=function(e){var t={url:k+"images/markers/"+e+".png",size:new google.maps.Size(20,20)};return t},this.highlight_location=function(t,n){var n=$.extend({func:void 0,pan:!1,reset_zoom_center:!0,sublocation:!1},n);n.sublocation||G.clear(),$.ajax({url:b.replace("%s",t),dataType:"json",success:function(a,i,l){var s=A.mapTypeId,r="illustrated"===s?"illustrated_point":"googlemap_point",c="illustrated"===s?W.zoom:D.zoom,u="illustrated"===s?W.center:D.center;"undefined"!=typeof n.func&&n.func(a),"Group"==a.object_type?(P=t,A.panTo(new google.maps.LatLng(a[r][0],a[r][1])),$.each(a.locations.ids,function(t,n){e.highlight_location(n,{sublocation:!0}),t==a.locations.ids.length-1&&$("body").bind("highlight-location-loaded",function(t,o){if(o==n&&($("body").unbind("highlight-location-loaded"),"undefined"!=typeof a[r])){var i=[],l=0,c=0,u=null,g=null,h=.09,p=.05;for(g=E?16:"illustrated"==s?16:19,$.each(G.infos,function(e,t){var n=t.box.getPosition();null!=n&&i.push(n)}),$.each(i,function(t,n){$.each(i,function(o,a){if(t!=o){var i=e.calc_distance(n,a);i>0&&(l+=i,c+=1)}})}),u=l/c;u>h;)h+=p,g-=1;E?A.setZoom(g-1):("illustrated"==s?(12>g&&(g=12),g>16&&(g=16)):g=15>g?15:g,A.setZoom(g))}})}),null!=V&&V.change_buttons({loc_id:t,title:a.name})):"undefined"!=typeof a[r]&&null!=a[r]&&(G.register(new o(a[r],a.name,{link:a.profile_link})),n.sublocation||(P=t,null!=V&&V.change_buttons({loc_id:t,title:a.name})),$("body").trigger("highlight-location-loaded",[t]))}})},this.calc_distance=function(e,t){var n=e.lat(),o=e.lng(),a=t.lat(),i=t.lng(),l=null,s=null,r=6371;return n*=Math.PI/180,o*=Math.PI/180,a*=Math.PI/180,i*=Math.PI/180,Math.acos(Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos(i-o))*r},this.resize_canvas=function(){var e=Number($(window).height()),t=100,n=Number($("#map header").height()),o=Number($("footer").height()),a=t+n+o,i=e-a,l=i-($("#search").height()+90);$("#map-canvas").height(i).fadeIn(),0===q&&(q=500>l?l:500)}}function g(){"undefined"!=typeof console&&console.log(arguments)}var h=this,p={simple:!1,canvas_id:"map-canvas",pan_control:!0,zoom_control:!0,street_view_control:!0,map_type_control:!0,infobox_location_id:null,illustrated:!1},e=$.extend({},p,e),d=["emergency-aeds","emergency-phones"],m=e.points,f=e.shuttle_routes,v=e.shuttle_stops,y=e.base_ignore_types,k=e.urls["static"],_=e.urls.search,b=e.urls.location,w=e.urls.parking_json,T=e.urls.dining,L=e.urls.parking_kml,C=e.urls.buildings_kml,M=e.urls.sidewalks_kml,I=e.urls.bikeracks,x=e.urls.phones,z=e.urls.aeds,O=e.urls.stations,R=e.urls.base_url,S=search_query_get,E=e.simple,P=null,j=[],D=null,W=null,N=null,A=null,B=null,V=null,U=null,G=null,q=0,H=new u;if(H.resize_canvas(),"undefined"==typeof google)return void g("Unable to load google code");!function(){var t=window.location+"",n=t.split("/");n.length>3&&(n=n.splice(3),$.each(n,function(t,n){if("map"!=n&&""!=n)if("illustrated"==n)e.illustrated=!0;else if("emergency"==n)for(l in d)j.push(d[l]);else j.push(n)}))}(),$zoom=getZoom();var F={mapTypeIds:[]};isDesktopWidth&&(F={mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN,"illustrated"],position:google.maps.ControlPosition.RIGHT_BOTTOM}),D={zoom:$zoom,center:new google.maps.LatLng(28.6018,-81.1995),mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:e.pan_control,panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:e.zoom_control,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_BOTTOM},streetViewControl:e.street_view_control,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:e.map_type_control,mapTypeControlOptions:F},W={zoom:14,center:new google.maps.LatLng(85.04591,-179.94189),mapTypeId:"illustrated",panControl:e.pan_control,zoomControl:e.zoom_control,streetViewControl:e.street_view_control,mapTypeControl:e.map_type_control},N={tileSize:new google.maps.Size(256,256),minZoom:12,maxZoom:16,getTile:function(e,t,n){var o=n.createElement("div");return o.style.width=this.tileSize.width+"px",o.style.height=this.tileSize.height+"px",o.style.backgroundImage=H.get_illustrated_tile(e,t),o},name:"Illustrated",alt:"Show illustrated map"},google.maps.visualRefresh=!0,A=new google.maps.Map(document.getElementById(e.canvas_id),e.illustrated?W:D),A.mapTypes.set("illustrated",N),google.maps.event.addListener(A,"maptypeid_changed",function(){var e=A.mapTypeId,t="illustrated"===e?W:D,n=U.get_layer("gpoints"),o=U.get_layer("ipoints");A.setZoom(t.zoom),A.setCenter(t.center),"illustrated"==e?(n.deactivate(),o.activate()):(o.deactivate(),n.activate()),G.clear(),null!=P&&H.highlight_location(P)}),e.simple||($(window).resize(H.resize_canvas),B=new c,V=new r,MOBILE_MENU=new s),G=new n,e.simple||(U=new a,isDesktopWidth&&U.register_layer(function(){var e=new i("traffic");return e.layer=new google.maps.TrafficLayer,e}()),isDesktopWidth&&U.register_layer(function(){var e=new i("sidewalks");return e.layer=new google.maps.KmlLayer(M,{preserveViewport:!0,suppressInfoWindows:!0,clickable:!1}),e}()),isDesktopWidth&&U.register_layer(function(){var e=new i("gpoints");return e.markers=function(){var e=[],t={Building:H.get_google_image("building"),ParkingLot:H.get_google_image("parking"),Group:H.get_google_image("group"),Location:H.get_google_image("location")},n="gpoint";return $.each(m,function(o,a){var i=a[n],l=null;null!=i&&-1==$.inArray(a.type,y)&&(l=new google.maps.Marker({position:new google.maps.LatLng(i[0],i[1]),map:A,icon:t[a.type],location:o,visible:!1}),e.push(l),google.maps.event.addListener(l,"click",function(e){H.highlight_location(o)}))}),e}(),e}()),isDesktopWidth&&U.register_layer(function(){var e=new i("ipoints");return e.markers=function(){var e=[],t={Building:H.get_google_image("building"),ParkingLot:H.get_google_image("parking"),Group:H.get_google_image("group"),Location:H.get_google_image("blue")},n="ipoint";return $.each(m,function(o,a){var i=a[n],l=null;null!=i&&-1==$.inArray(a.type,y)&&(l=new google.maps.Marker({position:new google.maps.LatLng(i[0],i[1]),map:A,icon:t[a.type],location:o,visible:!1}),e.push(l),google.maps.event.addListener(l,"click",function(e){H.highlight_location(o)}))}),e}(),e}()),isDesktopWidth&&U.register_layer(function(){var e=new i("buildings");return e.layer=new google.maps.KmlLayer(C,{preserveViewport:!0,suppressInfoWindows:!0,clickable:!1}),e}()),isDesktopWidth&&U.register_layer(function(){var e=new i("bikeracks");return e.markers=function(){var e=[],t={url:k+"/images/markers/bicycle.png",size:new google.maps.Size(25,25)};return $.ajax({url:I,dataType:"json",async:!1,success:function(n,o,a){"undefined"!=typeof n.features&&$.each(n.features,function(n,o){o.geometry&&o.geometry.coordinates&&e.push(new google.maps.Marker({clickable:!1,position:new google.maps.LatLng(o.geometry.coordinates[0],o.geometry.coordinates[1]),icon:t,map:A,visible:!1}))})}}),e}(),e}()),U.register_layer(function(){var e=new i("emergency-phones");return e.markers=function(){var e=[];return $.ajax({url:x,dataType:"json",async:!1,success:function(t,n,o){var a={url:k+"/images/markers/phone.png",size:new google.maps.Size(25,25)};"undefined"!=typeof t.features&&$.each(t.features,function(t,n){n.geometry&&n.geometry.coordinates&&e.push(new google.maps.Marker({clickable:!1,position:new google.maps.LatLng(n.geometry.coordinates[0],n.geometry.coordinates[1]),map:A,visible:!1,icon:a}))})}}),e}(),e}()),U.register_layer(function(){var e=new i("emergency-aeds");return e.markers=function(){var e=[];return $.ajax({url:z,dataType:"json",async:!1,success:function(t,n,o){var a={url:k+"/images/markers/aed.png",size:new google.maps.Size(25,25)};"undefined"!=typeof t.features&&$.each(t.features,function(t,n){n.geometry&&n.geometry.coordinates&&e.push(new google.maps.Marker({clickable:!1,position:new google.maps.LatLng(n.geometry.coordinates[0],n.geometry.coordinates[1]),map:A,visible:!1,icon:a}))})}}),e}(),e}()),isDesktopWidth&&U.register_layer(function(){var e=new i("charging-stations");return e.markers=function(){var e=[];return $.ajax({url:O,dataType:"json",async:!1,success:function(t,n,o){var a={url:k+"/images/markers/ev.png",size:new google.maps.Size(32,32)};"undefined"!=typeof t.features&&$.each(t.features,function(t,n){n.geometry&&n.geometry.coordinates&&e.push(new google.maps.Marker({clickable:!1,position:new google.maps.LatLng(n.geometry.coordinates[0],n.geometry.coordinates[1]),map:A,visible:!1,icon:a}))})}}),e}(),e}()),U.register_layer(function(){var e=new i("parking");return e.layer=new google.maps.KmlLayer(L,{preserveViewport:!0,suppressInfoWindows:!0}),e.markers=function(){var e=[];return $.ajax({url:w,dataType:"json",async:!1,success:function(t){var n={url:k+"images/markers/handicap.png",size:new google.maps.Size(25,25)};"undefined"!=typeof t.handicap&&$.each(t.handicap,function(t,o){e.push(new google.maps.Marker({icon:n,position:new google.maps.LatLng(o.googlemap_point[0],o.googlemap_point[1]),map:A,title:o.title,visible:!1}))})}}),e}(),e}()),U.register_layer(function(){var e=new i("food");return e.markers=function(){var e=[],t=function(e,t){this.lat=e,this.lon=t,this.count=1,this.odd_flip=!0},n=function(){return Math.round(10*Math.random())+Math.round(10*Math.random())},o=[],a=15e4,i={url:k+"images/markers/food.png",size:new google.maps.Size(25,25)};return $.ajax({url:T,dataType:"json",async:!1,success:function(l){"undefined"!=typeof l.features&&$.each(l.features,function(l,s){var r=s.geometry.coordinates,c=!1;$.each(o,function(e,t){if(r[0]==t.lat&&r[1]==t.lon){var o=t.count;return o%2==0?(r[0]=r[0]+(o+n())/a,o%4==0?r[1]=r[1]+(o+n())/a:r[1]=r[1]-(o+n())/a):(r[0]=r[0]-(o+n())/a,t.odd_flip?(r[1]=r[1]+(o+n())/a,t.odd_flip=!1):(r[1]=r[1]-(o+n())/a,t.odd_flip=!0)),c=!0,t.count+=1,!1}}),c||o.push(new t(r[0],r[1])),e.push(new google.maps.Marker({icon:i,position:new google.maps.LatLng(r[0],r[1]),title:s.properties.name,map:A,visible:!1}))})}}),e}(),e}()),isDesktopWidth&&!function(){$.each(v,function(e,t){$("#shuttle-stop-wrapper select").append($("<option></option>").attr("value",t.id).text(t.name))});var e=null,n=null;$("#shuttle-stop-wrapper select").change(function(){var t=$(this).val();if(""!=t){for(var o in v)if(stop=v[o],stop.id==t){if(null!=e){e.setPosition(new google.maps.LatLng(stop.lat,stop.lon)),e.setVisible(!0);var a="";for(var i in stop.routes)a+='<br><a class="route-link" href="#shuttle-'+stop.routes[i].shortname.replace(/ /g,"-")+'">'+stop.routes[i].shortname+"</a>";n.setContent("<div><b>Stop:</b> "+stop.name+"<br><b>Routes:</b>"+a+"</div>")}else{e=new google.maps.Marker({position:new google.maps.LatLng(stop.lat,stop.lon),map:A,title:stop.name});var a="";for(var i in stop.routes)a+='<br><a class="route-link" href="#shuttle-'+stop.routes[i].shortname.replace(/ /g,"-")+'">'+stop.routes[i].shortname+"</a>";n=new google.maps.InfoWindow({content:"<div><b>Stop:</b> "+stop.name+"<br><b>Routes:</b>"+a+"</div>"}),google.maps.event.addListener(e,"click",function(){n.open(A,e)})}n.open(A,e),A.panTo(new google.maps.LatLng(stop.lat,stop.lon));break}}else null!=e&&(e.setVisible(!1),n.close())}),$(".route-link").live("click",function(e){e.preventDefault();var t=$(this);$(t.attr("href")).click()}),$.each(f.routes,function(e,t){var n="shuttle-"+t.shortname.replace(/ /g,"-"),o=t.category.replace(/ /g,"-").toLowerCase()+"-routes",a=$("#"+o),l='<label><input type="checkbox" id="'+n+'"> '+t.shortname+"</label>";a.append(l),v.length>0&&U.register_layer(function(){var e=new i(n);return e.layer=new google.maps.KmlLayer(R+"/shuttles/"+t.id+"/poly/.kml?&_="+(new Date).getTime(),{preserveViewport:!0,suppressInfoWindows:!0}),e.markers=function(e){var t=[];return $.ajax({url:"/shuttles/"+e+"/stops/.json",dataType:"json",async:!0,success:function(e){"undefined"!=typeof e.stops&&$.each(e.stops,function(e,n){var o=new google.maps.Marker({position:new google.maps.LatLng(n.lat,n.lon),map:A,title:n.name,visible:!1}),a=new google.maps.InfoWindow({content:"<div>Stop: "+n.name+"</div>"});google.maps.event.addListener(o,"click",function(){a.open(A,o)}),t.push(o)})}}),t}(t.id),e.shuttleRouteId=t.id,e}())});var o=setInterval(function(){$.each(U.layers,function(e,n){null!=n.shuttleRouteId&&n.active&&t(n)})},4e3);$("#refresh-shuttle-gps").click(function(){$(this).is(":checked")?o=setInterval(function(){$.each(U.layers,function(e,n){null!=n.shuttleRouteId&&n.active&&t(n)})},4e3):clearInterval(o)})}(),function(){var t=!1;$.each(j,function(e,n){var o=U.get_layer(n);"shuttles"==n?V.change_tabs({label:"Shuttles",html:$("#shuttle-routes-content").clone(!0,!0).show()}):null!=o&&(o.activate(),t=!0,"parking"==o.name&&V.change_tabs({label:"Parking",html:$("#parking-key-content").html()}))}),isDesktopWidth&&(t||(e.illustrated?U.get_layer("ipoints").toggle():U.get_layer("gpoints").toggle()))}(),function(){$.each(U.layers,function(e,t){var n=t.name,o=$('input[type="checkbox"][id="'+t.name+'"]');t.active&&(-1!==t.name.search("emergency")&&$("#emergency").attr("checked",!0),o.attr("checked","checked")),o.click(function(){"parking"==$(this).attr("id")&&$(this).is(":checked")&&V.change_tabs({label:"Parking",html:$("#parking-key-content").html()}),t.toggle();var e=!1;for(l in d)1==U.get_layer(d[l]).active&&(e=!0);$("#emergency").attr("checked",e)})});var e=$("#shuttle-routes, .shuttle-routes-btn");e.click(function(){$(this).is(":checked")&&V.change_tabs({label:"Shuttles",html:$("#shuttle-routes-content").clone(!0,!0).show()})});var t=$("#shuttle-info-button");t.click(function(e){e.preventDefault(),V.change_tabs({label:"Shuttles",html:$("#shuttle-info").clone(!0,!0).show()})});var e=$(".shuttle-routes-btn");e.click(function(){V.change_tabs({label:"Shuttles",html:$("#shuttle-routes-content").clone(!0,!0).show()})}),0==v&&$("#route-information").hide();var n=$("#emergency, .emergency-btn");n.click(function(){if($(this).is(":checked")){var e=$("#emergency-content").clone(!0,!0).show();V.change_tabs({label:"Emergency",html:e},function(){e.find(".init-checked:not(:checked)").attr("checked",!0),n.attr("checked",!0);for(l in d)U.get_layer(d[l]).activate()})}else{for(l in d)U.get_layer(d[l]).deactivate();$('#emergency-content input[type="checkbox"](:checked)').attr("checked",!1)}})}(),$("#search > ul > li:not(.more)").live("click",function(){var e=$(this).find("a").attr("data-pk");e&&(V.change_tabs({label:"Location",html:'<div class="item load">Loading...</div>'}),H.highlight_location(e,{func:function(e){V.change_tabs({html:e.info})}})),B.hide_results()}).find("a").live("click",function(e){e.preventDefault()}),$("body").bind("search-result-highlighted",function(e){var t=$("#search-results").find(".hover").find("a").attr("data-pk");t&&(V.change_tabs({label:"Location",html:'<div class="item load">Loading...</div>'}),H.highlight_location(t,{func:function(e){V.change_tabs({html:e.info})}}))})),null!=e.infobox_location_id&&H.highlight_location(e.infobox_location_id,{pan:!0})},getZoom=function(){return $width=$(window).width(),$width<295?14:$width>296&&$width<465?15:$width>466&&$width<768?15:$width>769&&$width<1600?16:17};$(gaTracking),$.fn.equalHeights=function(e){return $(this).each(function(){var e=0;$(this).children().each(function(t){$(this).height()>e&&(e=$(this).height())}),$(this).children().css({"min-height":e})}),this};